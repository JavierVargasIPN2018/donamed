# AnÃ¡lisis Comparativo: Nueva DocumentaciÃ³n vs Arquitectura Actual

## ğŸ“Š Resumen Ejecutivo

La nueva documentaciÃ³n de DONAMED define **31 requerimientos funcionales** organizados en **7 fases de negocio**. El proyecto actual tiene una arquitectura bien definida pero **sin implementaciÃ³n funcional** - solo cuenta con estructura base, componentes UI de shadcn, y configuraciÃ³n inicial.

---

## ğŸ› ï¸ Stack TÃ©cnico Confirmado

| Componente | TecnologÃ­a | JustificaciÃ³n |
|------------|------------|---------------|
| **Framework** | Next.js 16 + React 19 | App Router, Server Actions, RSC |
| **AutenticaciÃ³n** | **Better Auth** | TypeScript-first, integraciÃ³n nativa con Next.js 16 y Drizzle, plugin ecosystem robusto |
| **ORM** | **Drizzle ORM** | Sintaxis similar a SQL (fÃ¡cil aprendizaje), mejor performance que Prisma, ideal para serverless |
| **Base de Datos** | PostgreSQL | Relaciones complejas, integridad referencial |
| **UI Components** | shadcn/ui | Componentes accesibles y customizables |
| **ValidaciÃ³n** | Zod | Type-safe schemas |
| **Styling** | Tailwind CSS v4 | Utility-first CSS |

> [!NOTE]
> **Â¿Por quÃ© Drizzle?** Su sintaxis es casi idÃ©ntica a SQL nativo, lo que facilita el aprendizaje y debugging. AdemÃ¡s, tiene mejor performance que Prisma en entornos serverless (cold start ~10x mÃ¡s rÃ¡pido).

> [!NOTE]
> **Â¿Por quÃ© Better Auth?** Ofrece autenticaciÃ³n completa out-of-the-box (OAuth, 2FA, magic links) con type-safety total y se integra perfectamente con Drizzle ORM.

---

## ğŸ” Estado Actual del Proyecto

### âœ… Lo que YA existe:
- **Arquitectura definida**: Monolito modular con separaciÃ³n cliente/servidor
- **6 mÃ³dulos conceptuales**: Identity, Inventory, Matchmaking, Coordination, Resolution, Governance
- **Stack tÃ©cnico completo**: Next.js 16, React 19, PostgreSQL, Drizzle ORM, shadcn/ui
- **Infraestructura**: CI/CD, ESLint, Docker Compose, Husky hooks
- **Componentes UI**: 40+ componentes de shadcn/ui instalados
- **DocumentaciÃ³n**: ADRs, ARCHITECTURE.md, CONTRIBUTING.md

### âŒ Lo que NO existe (todo por implementar):
- **Base de datos**: [schema.ts](file:///home/cyborg-15/Donamed/donamed/src/server/db/schema.ts) estÃ¡ vacÃ­o (solo `export {}`)
- **Servicios backend**: No hay carpeta `src/server/modules/`
- **MÃ³dulos frontend**: No hay carpeta `src/client/modules/`
- **AutenticaciÃ³n**: Sin sistema de login/registro
- **API endpoints**: Solo existe [/api/health](file:///home/cyborg-15/Donamed/donamed/src/app/api/health)
- **LÃ³gica de negocio**: Ninguna funcionalidad implementada

---

## ğŸ†š ComparaciÃ³n: DocumentaciÃ³n Nueva vs Arquitectura Actual

### âœ… AlineaciÃ³n Perfecta

| Aspecto | Nueva DocumentaciÃ³n | Arquitectura Actual | Estado |
|---------|---------------------|---------------------|--------|
| **SeparaciÃ³n Cliente/Servidor** | âœ… ImplÃ­cito en RF | âœ… Hexagonal | âœ… Alineado |
| **MÃ³dulos por dominio** | âœ… 7 fases = 6 mÃ³dulos | âœ… 6 mÃ³dulos definidos | âœ… Alineado |
| **Base de datos relacional** | âœ… Relaciones complejas | âœ… PostgreSQL + Drizzle | âœ… Alineado |
| **Roles diferenciados** | âœ… Donador/Receptor/Admin | âœ… RF5 | âœ… Alineado |

### âš ï¸ Ajustes Necesarios

| Elemento | Nueva DocumentaciÃ³n | Arquitectura Actual | AcciÃ³n Requerida |
|----------|---------------------|---------------------|------------------|
| **Chat temporal** | âŒ NO mencionado | âœ… MÃ³dulo "Coordination" con chat | ğŸ”§ **ELIMINAR** mÃ³dulo de chat |
| **Lugares predefinidos** | âœ… RF18, RF28 | âŒ No contemplado | ğŸ”§ **AGREGAR** entidad `delivery_locations` |
| **Examen socioeconÃ³mico** | âœ… Fase 1 (pendiente definir) | âŒ No contemplado | ğŸ”§ **AGREGAR** a mÃ³dulo Identity |
| **ValidaciÃ³n de mÃ©dicos** | âœ… MatrÃ­cula para controlados | âŒ No contemplado | ğŸ”§ **AGREGAR** campo `medical_license` |
| **Sistema de reportes** | âœ… RF31 (denuncias) | âŒ No contemplado | ğŸ”§ **AGREGAR** entidad `reports` |
| **Firma digital** | âŒ NO (firma fÃ­sica) | âœ… Mencionado en Resolution | ğŸ”§ **CAMBIAR** a subida de imagen/PDF |

---

## ğŸš« Funcionalidades a ELIMINAR o MODIFICAR

### 1. **MÃ³dulo "Coordination" - Chat Temporal** âŒ
**RazÃ³n**: La nueva documentaciÃ³n NO menciona chat. La coordinaciÃ³n es simplemente:
- Donador selecciona lugar predefinido
- Sistema genera PDF
- Ambos reciben correo

**AcciÃ³n**: 
- âœ… Mantener mÃ³dulo "Coordination" pero SIN chat
- âœ… Enfocarlo en: selecciÃ³n de lugar, generaciÃ³n de PDF, notificaciones

### 2. **Firmas Digitales** âŒ
**RazÃ³n**: RF22 dice "Requerir firma fÃ­sica de ambas partes"

**AcciÃ³n**:
- âŒ NO implementar firma digital/electrÃ³nica
- âœ… Solo permitir subida de foto/PDF de orden firmada fÃ­sicamente

---

## ğŸ¯ Mapeo: Requerimientos Funcionales â†’ MÃ³dulos

| MÃ³dulo | Requerimientos Funcionales | Prioridad |
|--------|---------------------------|-----------|
| **Identity** | RF1, RF2, RF3, RF4, RF5 | ğŸ”´ **CRÃTICA** |
| **Inventory** | RF6, RF7, RF8, RF9, RF10, RF11, RF12 | ğŸ”´ **CRÃTICA** |
| **Matchmaking** | RF13, RF14, RF15, RF16 | ğŸŸ¡ **ALTA** |
| **Coordination** | RF17, RF18, RF19, RF20, RF21 | ğŸŸ¡ **ALTA** |
| **Resolution** | RF22, RF23, RF24, RF25, RF26 | ğŸŸ¢ **MEDIA** |
| **Governance** | RF27, RF28, RF29, RF30, RF31 | ğŸ”µ **BAJA** |

---

## ğŸ“ˆ Matriz de PriorizaciÃ³n de MÃ³dulos

### Criterios de EvaluaciÃ³n:
1. **Valor de Negocio** (1-5): Â¿QuÃ© tan crÃ­tico es para el flujo principal?
2. **Dependencias** (1-5): Â¿CuÃ¡ntos mÃ³dulos dependen de este?
3. **Esfuerzo** (1-5): Â¿QuÃ© tan complejo es implementar? (1=fÃ¡cil, 5=difÃ­cil)
4. **Score de Prioridad**: (Valor Ã— Dependencias) / Esfuerzo

| MÃ³dulo | Valor | Dependencias | Esfuerzo | Score | Prioridad |
|--------|-------|--------------|----------|-------|-----------|
| **Identity** | 5 | 5 | 3 | **8.3** | ğŸ¥‡ **#1** |
| **Inventory** | 5 | 4 | 4 | **5.0** | ğŸ¥ˆ **#2** |
| **Matchmaking** | 4 | 3 | 3 | **4.0** | ğŸ¥‰ **#3** |
| **Coordination** | 4 | 2 | 3 | **2.7** | **#4** |
| **Resolution** | 3 | 1 | 2 | **1.5** | **#5** |
| **Governance** | 2 | 1 | 3 | **0.7** | **#6** |

---

## ğŸ† MÃ³dulos Prioritarios (MVP)

### ğŸ¥‡ **#1 - Identity** (Score: 8.3)
**Â¿Por quÃ© es crÃ­tico?**
- **Bloquea todo**: Sin autenticaciÃ³n, no hay donadores ni receptores
- **Base de todo**: Todos los mÃ³dulos necesitan saber "quiÃ©n es el usuario"
- **Roles diferenciados**: Donador vs Receptor tienen flujos diferentes

**Stack TÃ©cnico:**
- **AutenticaciÃ³n**: [Better Auth](https://better-auth.com/) - LibrerÃ­a TypeScript-first con soporte nativo para Next.js 16
  - Razones: Type-safe, plugin ecosystem, soporte para mÃºltiples providers OAuth
  - IntegraciÃ³n nativa con Drizzle ORM
  - Soporte para 2FA, magic links, y passkeys out-of-the-box
- **ORM**: Drizzle ORM
  - Razones: Sintaxis similar a SQL (fÃ¡cil de aprender si conoces SQL)
  - Mejor performance que Prisma (sin overhead de binarios)
  - Ideal para serverless (cold start casi nulo)

**Funcionalidades clave:**
- âœ… Registro con roles (RF1)
- âœ… ValidaciÃ³n de datos (RF2)
- âœ… Login/Logout (RF3)
- âœ… Perfiles con estadÃ­sticas (RF4)
- âœ… Restricciones por rol (RF5)
- âœ… **NUEVO**: ValidaciÃ³n de matrÃ­cula mÃ©dica
- âœ… **NUEVO**: Examen socioeconÃ³mico (pendiente definir preguntas)

**Entidades de BD:**
```typescript
// Drizzle Schema
users (id, email, password_hash, role, created_at)
donor_profiles (user_id, postal_code, birth_date, medical_license, total_donations, recent_donations)
recipient_profiles (user_id, birth_date, disabilities, allergies, socioeconomic_score, total_received)
```

**Esfuerzo estimado**: 3-5 dÃ­as (con Better Auth configurado)

---

### ğŸ¥ˆ **#2 - Inventory** (Score: 5.0)
**Â¿Por quÃ© es crÃ­tico?**
- **CorazÃ³n del negocio**: Sin publicaciones, no hay donaciones
- **Validaciones complejas**: Caducidad, ocultamiento automÃ¡tico
- **BÃºsqueda**: Algoritmo de distancia

**Funcionalidades clave:**
- âœ… Publicar medicamento (RF6, RF7)
- âœ… Validar caducidad (RF8)
- âœ… Ocultamiento automÃ¡tico <30 dÃ­as (RF10)
- âœ… BÃºsqueda por sustancia/gramaje (RF13)
- âœ… Estados de publicaciÃ³n (RF9)

**Entidades de BD:**
```
medications (id, donor_id, active_substance, dosage, quantity, brand, expiry_date, photo_url, lot, status, location, preferred_schedule, created_at)
```

**Esfuerzo estimado**: 4-6 dÃ­as (con validaciones y bÃºsqueda)

---

### ğŸ¥‰ **#3 - Matchmaking** (Score: 4.0)
**Â¿Por quÃ© es importante?**
- **Conecta donador-receptor**: El "match" es el momento clave
- **LÃ³gica de negocio**: Sugerencia por distancia, prevenciÃ³n de duplicidad

**Funcionalidades clave:**
- âœ… Solicitar medicamento (RF14)
- âœ… Formulario de necesidad mÃ©dica (RF15)
- âœ… Ver solicitudes (RF11)
- âœ… Seleccionar receptor (RF12)
- âœ… Sugerencia por distancia
- âœ… PrevenciÃ³n de duplicidad

**Entidades de BD:**
```
requests (id, medication_id, recipient_id, medical_justification, status, created_at)
donations (id, medication_id, donor_id, recipient_id, status, created_at)
```

**Esfuerzo estimado**: 3-4 dÃ­as

---

## ğŸ”„ Roadmap de ImplementaciÃ³n Sugerido

### **Fase 1: Fundamentos (Semana 1-2)** ğŸ”´ CRÃTICO
**Objetivo**: Usuarios pueden registrarse y publicar medicamentos

| Tarea | MÃ³dulo | DÃ­as | Responsable | Notas TÃ©cnicas |
|-------|--------|------|-------------|----------------|
| DiseÃ±o de esquema de BD completo | Todos | 1 | Backend | Drizzle schema con sintaxis SQL-like |
| Configurar Better Auth + Drizzle | Identity | 1 | Backend | IntegraciÃ³n nativa, type-safe |
| Implementar registro con roles | Identity | 1 | Backend | Donador/Receptor/Admin |
| Crear perfiles de usuario | Identity | 1 | Fullstack | UI + backend |
| CRUD de medicamentos | Inventory | 2 | Backend | Drizzle queries (similar a SQL) |
| UI de publicaciÃ³n | Inventory | 2 | Frontend | Formulario con validaciÃ³n Zod |
| ValidaciÃ³n de caducidad | Inventory | 1 | Backend | LÃ³gica de negocio + cron job |

**Entregable**: Donador puede registrarse y publicar medicamentos

**Stack confirmado**:
- âœ… Better Auth para autenticaciÃ³n (type-safe, plugins para 2FA/OAuth)
- âœ… Drizzle ORM para queries (sintaxis SQL-like, performance superior)

---

### **Fase 2: Matching (Semana 3-4)** ğŸŸ¡ ALTA
**Objetivo**: Receptores pueden buscar y solicitar medicamentos

| Tarea | MÃ³dulo | DÃ­as | Responsable |
|-------|--------|------|-------------|
| BÃºsqueda por sustancia/gramaje | Inventory | 2 | Backend |
| Algoritmo de distancia | Matchmaking | 2 | Backend |
| Sistema de solicitudes | Matchmaking | 2 | Backend |
| UI de bÃºsqueda y solicitud | Matchmaking | 2 | Frontend |
| SelecciÃ³n de receptor | Matchmaking | 1 | Fullstack |
| Notificaciones por correo | Coordination | 2 | Backend |

**Entregable**: Flujo completo de solicitud y aceptaciÃ³n

---

### **Fase 3: CoordinaciÃ³n y Cierre (Semana 5-6)** ğŸŸ¢ MEDIA
**Objetivo**: Generar orden de entrega y completar donaciÃ³n

| Tarea | MÃ³dulo | DÃ­as | Responsable |
|-------|--------|------|-------------|
| CatÃ¡logo de lugares predefinidos | Coordination | 1 | Backend |
| GeneraciÃ³n de PDF | Coordination | 2 | Backend |
| Subida de orden firmada | Resolution | 1 | Backend |
| ValidaciÃ³n de archivo | Resolution | 1 | Backend |
| UI de coordinaciÃ³n | Coordination | 2 | Frontend |
| Dashboard de donaciones | Governance | 2 | Frontend |

**Entregable**: DonaciÃ³n completa de punta a punta

---

### **Fase 4: AdministraciÃ³n (Semana 7+)** ğŸ”µ BAJA
**Objetivo**: Panel administrativo y reportes

| Tarea | MÃ³dulo | DÃ­as | Responsable |
|-------|--------|------|-------------|
| Panel administrativo | Governance | 3 | Fullstack |
| Sistema de reportes | Governance | 2 | Backend |
| GestiÃ³n de usuarios | Governance | 2 | Fullstack |
| EstadÃ­sticas y mÃ©tricas | Governance | 2 | Backend |

**Entregable**: Sistema completo con administraciÃ³n

---

## ğŸ¯ Recomendaciones EstratÃ©gicas

### 1. **Enfoque en MVP (Fases 1-3)**
- Las Fases 1-3 cubren el **80% del valor de negocio**
- Permiten validar el concepto con usuarios reales
- Governance puede esperar hasta tener tracciÃ³n

### 2. **ImplementaciÃ³n Incremental**
- Cada fase entrega valor funcional
- Permite feedback temprano
- Reduce riesgo de sobre-ingenierÃ­a

### 3. **Priorizar Backend Primero**
- Identity y Inventory son **backend-heavy**
- Frontend puede trabajar con mocks inicialmente
- Fullstack integra al final de cada sprint

### 4. **Elementos Pendientes de Definir**
> [!WARNING]
> Estos elementos bloquean la implementaciÃ³n completa:

- **Preguntas del examen socioeconÃ³mico** (Identity)
- **Lista de medicamentos controlados** (Inventory)
- **Lugares predefinidos de entrega** (Coordination)

**AcciÃ³n**: Solicitar al cliente estas definiciones ANTES de Fase 1

### 5. **Simplificaciones Posibles**
Para acelerar el MVP:
- **Examen socioeconÃ³mico**: Implementar despuÃ©s (no bloquea registro)
- **ValidaciÃ³n de mÃ©dicos**: Implementar despuÃ©s (permitir todos los medicamentos inicialmente)
- **Algoritmo de distancia**: Usar distancia lineal simple (no Google Maps API)

---

## ğŸ“‹ Checklist de Cambios ArquitectÃ³nicos

### Base de Datos
- [ ] Crear entidad `users` con campo `role`
- [ ] Crear entidad `donor_profiles` con `medical_license`
- [ ] Crear entidad `recipient_profiles` con `socioeconomic_score`
- [ ] Crear entidad `medications` con todos los campos (RF7)
- [ ] Crear entidad `requests` para solicitudes
- [ ] Crear entidad `donations` para tracking
- [ ] Crear entidad `delivery_locations` para lugares predefinidos
- [ ] Crear entidad `reports` para denuncias
- [ ] Crear entidad `delivery_orders` para PDFs generados

### MÃ³dulos a Modificar
- [ ] **Coordination**: Eliminar referencias a "chat temporal"
- [ ] **Coordination**: Agregar generaciÃ³n de PDF
- [ ] **Resolution**: Cambiar "firma digital" por "subida de archivo"
- [ ] **Identity**: Agregar validaciÃ³n de matrÃ­cula mÃ©dica
- [ ] **Identity**: Agregar examen socioeconÃ³mico (pendiente preguntas)

### Nuevas Funcionalidades
- [ ] Sistema de notificaciones por correo (4 eventos)
- [ ] ValidaciÃ³n automÃ¡tica de caducidad
- [ ] Ocultamiento automÃ¡tico <30 dÃ­as
- [ ] Algoritmo de sugerencia por distancia
- [ ] PrevenciÃ³n de duplicidad en donaciones activas
- [ ] GeneraciÃ³n de PDF con QR/ID Ãºnico
- [ ] Sistema de reportes/denuncias

---

## ğŸ“ ConclusiÃ³n

### âœ… Buenas Noticias:
- La arquitectura actual estÃ¡ **bien diseÃ±ada** y alineada con los requerimientos
- No hay funcionalidades implementadas que deban **eliminarse** (solo ajustar conceptos)
- El stack tÃ©cnico es **adecuado** para todos los requerimientos

### âš ï¸ Ajustes Necesarios:
- Eliminar concepto de "chat" del mÃ³dulo Coordination
- Cambiar "firma digital" por "subida de archivo fÃ­sico firmado"
- Agregar entidades nuevas (lugares, reportes, examen socioeconÃ³mico)

### ğŸš€ Siguiente Paso:
**Implementar Fase 1** (Identity + Inventory) para tener un MVP funcional en 2 semanas.

---

**Â¿Preguntas para el cliente?**
1. Â¿CuÃ¡les son las preguntas del examen socioeconÃ³mico?
2. Â¿CuÃ¡l es la lista de medicamentos controlados?
3. Â¿CuÃ¡les son los lugares predefinidos de entrega iniciales?
4. Â¿Hay algÃºn servicio de correo preferido? (SendGrid, AWS SES, etc.)
